
<source>
  @type  http
  port  9880
  bind 0.0.0.0
</source>

<source>
  @type  forward
  @id    input1
  port  24224
</source>


<filter car.*>
  @type record_transformer
  enable_ruby
  
  <record>
    location ${JSON.parse("{}").merge({"lat": record["Lat"], "lon": record["Lon"]})}
    car_id ${record["Car_no"]}
    speed ${record["Speed"]}
    @timestamp ${record["Timestamp"]}
    my_epoch ${record["MyEpoch"]}
  </record>

  remove_keys Lat, Lon, Car_no, Speed, Timestamp, MyEpoch

</filter>




<match car.*>
  @type copy

  # <store>
  #   @type stdout
  # </store>

  <store>
    @type elasticsearch
    host elastic
    port 9200
    index_name simulation
    type_name _doc
    <buffer>
      buffer_type memory
      flush_interval 5s
      retry_limit 17
      retry_wait 1.0
      num_threads 4
    </buffer>
  </store>
</match>

<match **>
  @type stdout
</match>